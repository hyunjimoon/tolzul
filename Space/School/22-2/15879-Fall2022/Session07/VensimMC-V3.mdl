{UTF-8}
InfShift[Shft]:INTERPOLATE::=
	-Shft
	~	
	~		|

ShiftedDeath[Rgn,Pssn]:INTERPOLATE::=
	TIME SHIFT(new dpm[Rgn], DeathShift[Pssn])
	~	
	~		|

DeathShift[Pssn]:INTERPOLATE::=
	-Pssn
	~	
	~		|

ShiftedInfection[Rgn,Shft]:INTERPOLATE::=
	TIME SHIFT(new cases[Rgn], InfShift[Shft])
	~	
	~		|

new cases[Rgn]
	~	Person/Day
	~		|

new dpm[Rgn] :RAW:
	~	Person/Day
	~		|

alp[Rgn]=
	0.1
	~	dmnl
	~	This parameter is 1 over the number of failures in negative binomial \
		before experiment is stopped. A value between 0 and 1 (excluding zero) is \
		legitimate calibraiton parameters here.
	|

alpha[Rgn]=
	alpha 0[Rgn]+1/(1+exp(timesens[Rgn]))*(alpha f[Rgn]-alpha 0[Rgn])
	~	
	~		|

alpha 0[Rgn]=
	1
	~	
	~		|

alpha f[Rgn]=
	2
	~	
	~		|

beta[Rgn]=
	0.1
	~	
	~		|

DataFlowOverTime[Rgn]:RAW::=
	 new cases[Rgn]
	~	Person/Day
	~		|

DataIncluded[Rgn]=
	1
	~	dmnl
	~		|

Di[Rgn]  = 
        DataFlowOverTime[Rgn]
	~	Person/Day
	~		|

DiseaseDuration=
	14
	~	
	~		|

dn[Rgn]=
	sum(PoissonDist[Rgn,Pssn!]*ShiftedDeath[Rgn,Pssn!])
	~	
	~		|

eps=
	0.01
	~	Person/Day
	~		|

g death[Rgn]=
	exp(-alpha[Rgn]*dn[Rgn])
	~	
	~		|

inf exp[Rgn]=
	beta[Rgn]*roll[Rgn]*g death[Rgn]
	~	Person/Day
	~		|

Mu[Rgn]=
	Max ( eps , 
	             inf exp[Rgn] )
	~	Person/Day
	~		|

NBL1[Rgn]  = 
        if then else ( DataFlowOverTime[Rgn] 
                  = 0, 
             - ln ( 1
                       + alp[Rgn] 
                            * Mu[Rgn] ) 
                  / alp[Rgn] , 
             0)
	~	dmnl
	~	This is the part of negative binomial distribution calcualted when \
		outcomes are zero.
	|

NBL2[Rgn]  = 
        if then else ( DataFlowOverTime[Rgn] 
                  > 0, 
             GAMMA LN ( Di[Rgn] 
                       + 1
                            / alp[Rgn] ) 
                  - GAMMA LN ( 1
                            / alp[Rgn] ) 
                  - GAMMA LN ( Di[Rgn] 
                            + 1) 
                  - ( Di[Rgn] 
                       + 1
                            / alp[Rgn] ) 
                       * ln ( 1
                                 + alp[Rgn] 
                                      * Mu[Rgn] ) 
                  + Di[Rgn] 
                       * ( ln ( alp[Rgn] ) 
                            + ln ( Mu[Rgn] ) ) , 
             0)
	~	dmnl
	~	This is the second piece in the loglikelihood for negative binomial which \
		only applies to non-zero data points.
	|

NBL3[Rgn]  = 
        if then else ( Di[Rgn] 
                  > 0, 
             - GAMMA LN ( Di[Rgn] 
                       + 1) 
                  - ( Di[Rgn] 
                       + 1
                            / alp[Rgn] ) 
                       * ln ( 1
                                 + alp[Rgn] 
                                      * Mu[Rgn] ) 
                  + Di[Rgn] 
                       * ( ln ( alp[Rgn] ) 
                            + ln ( Mu[Rgn] ) ) , 
             0)
	~	dmnl
	~		|

NBLLFlow[Rgn]=
	( NBL1[Rgn] 
	             + NBL2[Rgn] ) 
	             *DataIncluded[Rgn]
	~	dmnl
	~		|

PMean[Rgn]=
	5
	~	
	~		|

PoissonDist[Rgn,Pssn]= INITIAL(
	PMean[Rgn]^Pssn*exp(-PMean[Rgn])/exp(GAMMA LN( Pssn+1 )))
	~	
	~		|

Pssn:
	(p1-p100)
	~	
	~		|

Rgn:
	USA
	~	
	~	AFG, ALB, ARE, ARG, ARM, AUS, AUT, AZE, BEL, BGD,
		       BGR, BHR, BIH, BLR, BOL, BRA, CAN, CHE, CHL, CHN,
		       CIV, COD, COL, CRI, CZE, DEU, DNK, DOM, DZA, ECU,
		       EGY, ESP, ETH, FRA, GBR, GHA, GIN, GRC, GTM, HND,
		       HRV, HUN, IDN, IND, IRL, IRN, IRQ, ISR, ITA, JPN,
		       KAZ, KEN, KGZ, KOR, KOS, KWT, LBN, LBY, MAR, MDA,
		       MDG, MEX, MKD, MYS, NAM, NGA, NLD, NOR, NPL, OMN,
		       PAK, PAN, PER, PHL, POL, PRI, PRY, PSE, QAT, ROU,
		       RUS, SAU, SDN, SEN, SGP, SLV, SRB, SWE, TUN, TUR,
		       UKR, USA, UZB, VEN, ZAF, ZMB
	|

roll[Rgn]=
	sum(SelectRoll[Shft!]*ShiftedInfection[Rgn,Shft!])
	~	
	~		|

SelectRoll[Shft]=
	if then else(Shft>DiseaseDuration,0,1)
	~	
	~		|

Series:
	Infection
	~	
	~		|

Shft:
	(S1-S20)
	~	
	~		|

t0[Rgn]=
	20
	~	
	~		|

theta[Rgn]=
	1
	~	
	~		|

timesens[Rgn]=
	MIN(50, -(Time-t0[Rgn])/theta[Rgn])
	~	
	~		|

********************************************************
	.Control
********************************************************~
		Simulation Control Parameters
	|

FINAL TIME  = 300
	~	Day
	~	The final time for the simulation.
	|

INITIAL TIME  = 0
	~	Day
	~	The initial time for the simulation.
	|

SAVEPER  = 
        TIME STEP
	~	Day [0,?]
	~	The frequency with which output is stored.
	|

TIME STEP  = 1
	~	Day [0,?]
	~	The time step for the simulation.
	|

\\\---/// Sketch information - do not modify anything except names
V300  Do not put anything below this section - it will be ignored
*View 1
$192-192-192,0,Times New Roman|12||0-0-0|0-0-0|0-0-255|-1--1--1|-1--1--1|96,96,100,0
10,1,DataFlowOverTime,501,658,64,9,8,3,0,0,0,0,0,0,0,0,0,0,0,0
10,2,inf exp,822,444,22,11,8,131,0,0,0,0,0,0,0,0,0,0,0,0
10,3,new dpm,228,295,30,11,8,3,0,2,-1,0,0,0,0-0-0,0-0-0,|||0-0-255,0,0,0,0,0,0
10,4,new cases,302,650,33,11,8,3,0,2,-1,0,0,0,0-0-0,0-0-0,|||0-0-255,0,0,0,0,0,0
1,5,4,1,0,0,0,0,0,64,0,-1--1--1,,1|(0,0)|
10,6,NBL1,668,552,22,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
10,7,NBL2,773,544,22,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
10,8,NBL3,834,562,22,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
10,9,Di,563,597,9,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
10,10,Mu,929,533,13,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
1,11,1,9,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,12,2,10,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,13,9,7,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,14,10,6,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
10,15,alp,724,592,11,11,8,3,0,2,0,0,0,0,0-0-0,0-0-0,|||0-128-0,0,0,0,0,0,0
1,16,15,6,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,17,15,7,0,0,0,0,0,64,0,-1--1--1,,1|(0,0)|
1,18,10,8,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,19,15,8,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,20,9,8,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,21,10,7,0,0,0,0,0,64,0,-1--1--1,,1|(0,0)|
1,22,1,6,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,23,1,7,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
10,24,NBLLFlow,658,513,38,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
1,25,6,24,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,26,7,24,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
10,27,DataIncluded,428,537,43,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
1,28,27,24,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
10,29,alpha,851,276,18,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
10,30,alpha 0,890,208,24,11,8,3,0,2,0,0,0,0,0-0-0,0-0-0,|||0-128-0,0,0,0,0,0,0
10,31,alpha f,940,259,22,11,8,3,0,2,0,0,0,0,0-0-0,0-0-0,|||0-128-0,0,0,0,0,0,0
10,32,timesens,959,303,28,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
10,33,t0,1025,323,8,11,8,3,0,2,0,0,0,0,0-0-0,0-0-0,|||0-128-0,0,0,0,0,0,0
10,34,theta,989,358,17,11,8,3,0,2,0,0,0,0,0-0-0,0-0-0,|||0-128-0,0,0,0,0,0,0
1,35,33,32,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,36,34,32,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,37,32,29,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,38,31,29,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,39,30,29,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,40,29,65,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
10,41,beta,915,389,15,11,8,3,0,2,0,0,0,0,0-0-0,0-0-0,|||0-128-0,0,0,0,0,0,0
1,42,41,2,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
10,43,roll,497,436,12,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
1,44,43,2,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
10,45,dn,472,367,10,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
1,46,45,65,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
10,47,eps,1007,550,13,11,8,3,0,0,-1,0,0,0,0,0,0,0,0,0
1,48,47,10,0,0,0,0,0,64,0,-1--1--1,,1|(0,0)|
10,49,Time,917,345,26,11,8,2,0,3,-1,0,0,0,128-128-128,0-0-0,|||128-128-128,0,0,0,0,0,0
1,50,49,32,0,0,0,0,0,64,0,-1--1--1,,1|(0,0)|
10,51,ShiftedInfection,335,483,49,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
1,52,4,51,0,0,0,0,0,64,0,-1--1--1,,1|(0,0)|
10,53,ShiftedDeath,223,389,41,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
1,54,3,53,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
10,55,SelectRoll,345,438,33,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
10,56,DiseaseDuration,213,463,52,11,8,3,0,2,-1,0,0,0,0-0-0,0-0-0,|||0-128-0,0,0,0,0,0,0
1,57,56,55,0,0,0,0,0,64,0,-1--1--1,,1|(0,0)|
1,58,55,43,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,59,51,43,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
10,60,PoissonDist,336,225,38,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
10,61,PMean,265,185,24,11,8,3,0,2,-1,0,0,0,0-0-0,0-0-0,|||0-128-0,0,0,0,0,0,0
1,62,61,60,0,0,0,0,0,64,1,-1--1--1,,1|(0,0)|
1,63,60,45,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,64,53,45,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
10,65,g death,734,355,24,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
1,66,65,2,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
12,67,0,1479,78,92,28,8,7,0,0,-1,0,0,0,0,0,0,0,0,0
V1 - renames data variables, dropped constants file as not needed
12,68,0,1476,166,79,28,8,7,0,0,-1,0,0,0,0,0,0,0,0,0
V2 - fixed TIME SHIFT direction, pinned DiseaseDuration at 14
10,69,DeathShift,140,357,34,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
10,70,InfShift,226,520,24,11,8,3,0,0,0,0,0,0,0,0,0,0,0,0
1,71,69,53,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
1,72,70,51,0,0,0,0,0,128,0,-1--1--1,,1|(0,0)|
12,73,0,1481,244,70,19,8,7,0,0,-1,0,0,0,0,0,0,0,0,0
V3 - added cap of 50 on timesens variable
///---\\\
:L<%^E!@
9:testMCMC
11:VensimMCMC-V0.voc
12:MCMCPayoff-V0.vpd
13:InputData.vdf
15:1,0,0,0,0,0
19:100,0
27:0,
34:0,
4:Time
5:ShiftedDeath[Rgn,Pssn]
35:Date
36:YYYY-MM-DD
37:2000
38:1
39:1
40:4
41:0
42:1
24:0
25:300
26:300
6:Infection
6:p1
6:p10
6:p11
6:p12
6:p13
6:p14
6:p15
6:p16
6:p17
6:p18
6:p19
6:p2
6:p20
6:p21
6:p22
6:p23
6:p24
6:p25
6:p26
6:p27
6:p28
6:p29
6:p3
6:p30
6:p31
6:p32
6:p33
6:p34
6:p35
6:p36
6:p37
6:p38
6:p39
6:p4
6:p40
6:p41
6:p42
6:p43
6:p44
6:p45
6:p46
6:p47
6:p48
6:p49
6:p5
6:p50
6:p51
6:p52
6:p53
6:p54
6:p55
6:p56
6:p57
6:p58
6:p59
6:p6
6:p60
6:p7
6:p8
6:p9
6:S1
6:USA
